<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Collection of various loss and metric functions">

<title>drone_detector - Custom losses and metrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="drone_detector - Custom losses and metrics">
<meta property="og:description" content="Collection of various loss and metric functions">
<meta property="og:site-name" content="drone_detector">
<meta name="twitter:title" content="drone_detector - Custom losses and metrics">
<meta name="twitter:description" content="Collection of various loss and metric functions">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">drone_detector</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./utils.html">Common</a></li><li class="breadcrumb-item"><a href="./metrics.html">Custom losses and metrics</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GIS-data and deep learning</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.tiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples on how to use tiling utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.fastai.segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using fastai for segmentation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Processing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./processing.tiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tiling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./processing.coordinates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Coordinate transformations for vector data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./processing.coco.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">COCO utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_processing.yolo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">yolo utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./processing.postprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postprocessing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Common</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metrics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Custom losses and metrics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Engines</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.engines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep learning engines and helpers</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">fastai</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.fastai.data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom data used in remote sensing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.fastai.losses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom losses for segmentation and object detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.fastai.augmentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Augmentations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.fastai.predict.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLI for inference using fastai models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">detectron2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.detectron2.predict.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLI for using Detectron2 models for inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.detectron2.training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Helpers for detectron2 training</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.detectron2.augmentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data augmentation for detectron2 models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engines.detectron2.tta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom TTA modifications for detectron2</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#classification-metrics" id="toc-classification-metrics" class="nav-link active" data-scroll-target="#classification-metrics">Classification metrics</a>
  <ul class="collapse">
  <li><a href="#adjusted_r2score" id="toc-adjusted_r2score" class="nav-link" data-scroll-target="#adjusted_r2score">adjusted_R2Score</a></li>
  </ul></li>
  <li><a href="#regression-metrics" id="toc-regression-metrics" class="nav-link" data-scroll-target="#regression-metrics">Regression metrics</a>
  <ul class="collapse">
  <li><a href="#rrmse" id="toc-rrmse" class="nav-link" data-scroll-target="#rrmse">rrmse</a></li>
  <li><a href="#bias" id="toc-bias" class="nav-link" data-scroll-target="#bias">bias</a></li>
  <li><a href="#bias_pct" id="toc-bias_pct" class="nav-link" data-scroll-target="#bias_pct">bias_pct</a></li>
  </ul></li>
  <li><a href="#bigearthnet-metrics" id="toc-bigearthnet-metrics" class="nav-link" data-scroll-target="#bigearthnet-metrics">BigEarthNet metrics</a>
  <ul class="collapse">
  <li><a href="#label_ranking_average_precision_score" id="toc-label_ranking_average_precision_score" class="nav-link" data-scroll-target="#label_ranking_average_precision_score">label_ranking_average_precision_score</a></li>
  <li><a href="#label_ranking_loss" id="toc-label_ranking_loss" class="nav-link" data-scroll-target="#label_ranking_loss">label_ranking_loss</a></li>
  <li><a href="#one_error" id="toc-one_error" class="nav-link" data-scroll-target="#one_error">one_error</a></li>
  <li><a href="#coverage_error" id="toc-coverage_error" class="nav-link" data-scroll-target="#coverage_error">coverage_error</a></li>
  </ul></li>
  <li><a href="#segmentation-metrics" id="toc-segmentation-metrics" class="nav-link" data-scroll-target="#segmentation-metrics">Segmentation metrics</a>
  <ul class="collapse">
  <li><a href="#jaccardcoeffmulti" id="toc-jaccardcoeffmulti" class="nav-link" data-scroll-target="#jaccardcoeffmulti">JaccardCoeffMulti</a></li>
  </ul></li>
  <li><a href="#object-detection-metrics-and-evaluation-for-shapefiles-mostly-obsolete-use-giscocoeval-instead" id="toc-object-detection-metrics-and-evaluation-for-shapefiles-mostly-obsolete-use-giscocoeval-instead" class="nav-link" data-scroll-target="#object-detection-metrics-and-evaluation-for-shapefiles-mostly-obsolete-use-giscocoeval-instead">Object detection metrics and evaluation for shapefiles MOSTLY OBSOLETE, USE GisCOCOEval instead</a>
  <ul class="collapse">
  <li><a href="#poly_iou" id="toc-poly_iou" class="nav-link" data-scroll-target="#poly_iou">poly_IoU</a></li>
  <li><a href="#poly_dice" id="toc-poly_dice" class="nav-link" data-scroll-target="#poly_dice">poly_dice</a></li>
  <li><a href="#is_true_positive" id="toc-is_true_positive" class="nav-link" data-scroll-target="#is_true_positive">is_true_positive</a></li>
  <li><a href="#is_false_positive" id="toc-is_false_positive" class="nav-link" data-scroll-target="#is_false_positive">is_false_positive</a></li>
  <li><a href="#average_precision" id="toc-average_precision" class="nav-link" data-scroll-target="#average_precision">average_precision</a></li>
  <li><a href="#average_recall" id="toc-average_recall" class="nav-link" data-scroll-target="#average_recall">average_recall</a></li>
  </ul></li>
  <li><a href="#object-detection-metrics-with-pycocotools-and-gis-data" id="toc-object-detection-metrics-with-pycocotools-and-gis-data" class="nav-link" data-scroll-target="#object-detection-metrics-with-pycocotools-and-gis-data">Object detection metrics with pycocotools and gis-data</a>
  <ul class="collapse">
  <li><a href="#giscocoeval" id="toc-giscocoeval" class="nav-link" data-scroll-target="#giscocoeval">GisCOCOeval</a></li>
  <li><a href="#giscocoeval.prepare_data" id="toc-giscocoeval.prepare_data" class="nav-link" data-scroll-target="#giscocoeval.prepare_data">GisCOCOeval.prepare_data</a></li>
  <li><a href="#giscocoeval.prepare_eval" id="toc-giscocoeval.prepare_eval" class="nav-link" data-scroll-target="#giscocoeval.prepare_eval">GisCOCOeval.prepare_eval</a></li>
  <li><a href="#giscocoeval.evaluate" id="toc-giscocoeval.evaluate" class="nav-link" data-scroll-target="#giscocoeval.evaluate">GisCOCOeval.evaluate</a></li>
  <li><a href="#giscocoeval.save_results" id="toc-giscocoeval.save_results" class="nav-link" data-scroll-target="#giscocoeval.save_results">GisCOCOeval.save_results</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mayrajeo/drone_detector/tree/master/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Custom losses and metrics</h1>
</div>

<div>
  <div class="description">
    Collection of various loss and metric functions
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="classification-metrics" class="level2">
<h2 class="anchored" data-anchor-id="classification-metrics">Classification metrics</h2>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L23" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="adjusted_r2score" class="level3">
<h3 class="anchored" data-anchor-id="adjusted_r2score">adjusted_R2Score</h3>
<blockquote class="blockquote">
<pre><code> adjusted_R2Score (r2_score, n, k)</code></pre>
</blockquote>
<p>Calculates adjusted_R2Score based on r2_score, number of observations (n) and number of predictor variables(k)</p>
</section>
</section>
<section id="regression-metrics" class="level2">
<h2 class="anchored" data-anchor-id="regression-metrics">Regression metrics</h2>
<hr>
<section id="rrmse" class="level3">
<h3 class="anchored" data-anchor-id="rrmse">rrmse</h3>
<blockquote class="blockquote">
<pre><code> rrmse (preds, targs)</code></pre>
</blockquote>
<p>Relative RMSE. Normalized with mean of the target</p>
<hr>
</section>
<section id="bias" class="level3">
<h3 class="anchored" data-anchor-id="bias">bias</h3>
<blockquote class="blockquote">
<pre><code> bias (preds, targs)</code></pre>
</blockquote>
<p>Average bias of predictions</p>
<hr>
</section>
<section id="bias_pct" class="level3">
<h3 class="anchored" data-anchor-id="bias_pct">bias_pct</h3>
<blockquote class="blockquote">
<pre><code> bias_pct (preds, targs)</code></pre>
</blockquote>
<p>Mean weighted bias, normalized with mean of the target</p>
</section>
</section>
<section id="bigearthnet-metrics" class="level2">
<h2 class="anchored" data-anchor-id="bigearthnet-metrics">BigEarthNet metrics</h2>
<blockquote class="blockquote">
<p>Metrics used in BigEarthNet paper to evaluate multi-label classification</p>
</blockquote>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L55" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="label_ranking_average_precision_score" class="level3">
<h3 class="anchored" data-anchor-id="label_ranking_average_precision_score">label_ranking_average_precision_score</h3>
<blockquote class="blockquote">
<pre><code> label_ranking_average_precision_score (sigmoid=True, sample_weight=None)</code></pre>
</blockquote>
<p>Label ranking average precision (LRAP) is the average over each ground truth label assigned to each sample, of the ratio of true vs.&nbsp;total labels with lower score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.learner <span class="im">import</span> Learner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TstLearner(Learner):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,dls<span class="op">=</span><span class="va">None</span>,model<span class="op">=</span><span class="va">None</span>,<span class="op">**</span>kwargs): <span class="va">self</span>.pred,<span class="va">self</span>.xb,<span class="va">self</span>.yb <span class="op">=</span> <span class="va">None</span>,<span class="va">None</span>,<span class="va">None</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_val(met, x1, x2):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    met.reset()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">15</span>,<span class="dv">20</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    learn <span class="op">=</span> TstLearner()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        learn.pred,learn.yb <span class="op">=</span> x1[vals[i]:vals[i<span class="op">+</span><span class="dv">1</span>]],(x2[vals[i]:vals[i<span class="op">+</span><span class="dv">1</span>]],)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        met.accumulate(learn)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> met.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x_1 <span class="op">=</span> torch.randn(<span class="dv">10</span>,<span class="dv">3</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>x_2 <span class="op">=</span> torch.randint(<span class="dv">2</span>,(<span class="dv">10</span>,<span class="dv">3</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>x_1, torch.sigmoid(x_1), x_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(tensor([[-0.0175, -1.1692,  0.4717],
         [-0.1019,  1.7057,  0.8773],
         [-0.6633,  0.0593,  1.3823],
         [-0.6155, -0.4767, -1.4756],
         [-1.0687,  0.0246, -0.3407],
         [ 0.8646, -0.5164,  0.7274],
         [-0.7253,  0.6507,  0.2994],
         [-0.8993,  0.8574,  0.3334],
         [ 0.5395,  0.5471,  0.7207],
         [ 0.5087, -0.7967,  0.5395]]),
 tensor([[0.4956, 0.2370, 0.6158],
         [0.4745, 0.8463, 0.7063],
         [0.3400, 0.5148, 0.7994],
         [0.3508, 0.3830, 0.1861],
         [0.2557, 0.5061, 0.4156],
         [0.7036, 0.3737, 0.6742],
         [0.3262, 0.6572, 0.5743],
         [0.2892, 0.7021, 0.5826],
         [0.6317, 0.6335, 0.6728],
         [0.6245, 0.3107, 0.6317]]),
 tensor([[1, 0, 0],
         [1, 1, 0],
         [1, 1, 1],
         [0, 0, 1],
         [1, 1, 1],
         [1, 0, 0],
         [0, 0, 0],
         [0, 1, 0],
         [1, 0, 1],
         [0, 1, 0]]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lrap <span class="op">=</span> label_ranking_average_precision_score()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>compute_val(lrap, x_1, x_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.7833333333333332</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L63" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="label_ranking_loss" class="level3">
<h3 class="anchored" data-anchor-id="label_ranking_loss">label_ranking_loss</h3>
<blockquote class="blockquote">
<pre><code> label_ranking_loss (sigmoid=True, sample_weight=None)</code></pre>
</blockquote>
<p>Compute the average number of label pairs that are incorrectly ordered given y_score weighted by the size of the label set and the number of labels not in the label set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lrl <span class="op">=</span> label_ranking_loss()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>compute_val(lrl, x_1, x_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.35</code></pre>
</div>
</div>
<hr>
</section>
<section id="one_error" class="level3">
<h3 class="anchored" data-anchor-id="one_error">one_error</h3>
<blockquote class="blockquote">
<pre><code> one_error (preds, targs)</code></pre>
</blockquote>
<p>Rate for which the top ranked label is not among ground truth</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>one_error(x_1, x_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(0.4000)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L82" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="coverage_error" class="level3">
<h3 class="anchored" data-anchor-id="coverage_error">coverage_error</h3>
<blockquote class="blockquote">
<pre><code> coverage_error (sigmoid=True, sample_weight=None)</code></pre>
</blockquote>
<p>Compute how far we need to go through the ranked scores to cover all true labels. The best value is equal to the average number of labels in y_true per sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cov <span class="op">=</span> coverage_error()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>compute_val(cov, x_1, x_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2.2</code></pre>
</div>
</div>
</section>
</section>
<section id="segmentation-metrics" class="level2">
<h2 class="anchored" data-anchor-id="segmentation-metrics">Segmentation metrics</h2>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L90" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="jaccardcoeffmulti" class="level3">
<h3 class="anchored" data-anchor-id="jaccardcoeffmulti">JaccardCoeffMulti</h3>
<blockquote class="blockquote">
<pre><code> JaccardCoeffMulti (axis=1)</code></pre>
</blockquote>
<p>Averaged Jaccard coefficient for multiclass target in segmentation. Excludes background class</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> torch.randn(<span class="dv">20</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> torch.randint(<span class="dv">0</span>, <span class="dv">6</span>, (<span class="dv">20</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> x1.argmax(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>compute_val(JaccardCoeffMulti(), x1, x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.08437537158034053</code></pre>
</div>
</div>
</section>
</section>
<section id="object-detection-metrics-and-evaluation-for-shapefiles-mostly-obsolete-use-giscocoeval-instead" class="level2">
<h2 class="anchored" data-anchor-id="object-detection-metrics-and-evaluation-for-shapefiles-mostly-obsolete-use-giscocoeval-instead">Object detection metrics and evaluation for shapefiles MOSTLY OBSOLETE, USE GisCOCOEval instead</h2>
<p>To evaluate our collection of predicted masks, we’ll compare each of our predicted masks with each of the available target masks for a given input.</p>
<ul>
<li>A <strong>true positive</strong>, when a prediction-target mask pair has an IoU score which exceeds some predefined threshold</li>
<li>A <strong>false positive</strong>, when a predicted object had no associated ground truth object mask</li>
<li>A <strong>false negative</strong> indicates a ground truth object mask had no associated predicted object mask</li>
</ul>
<p>In the case of multiple detections, the one with the highest confidence is considered to be “correct” and others are FP.</p>
<p>From these, we can get <strong>Precision</strong> and <strong>Recall</strong></p>
<p><span class="math inline">\(Precision = \frac{TP}{TP + FP} = \frac{TP}{all \: detections}, Recall = \frac{TP}{TP+FN} = \frac{TP}{all \: ground \: truths}\)</span></p>
<p>And use these to derive other metrics.</p>
<p>Typical metrics include <strong>Average Precision</strong> (AP) and <strong>mean Average Precision</strong> (mAP). From these several metrics can be derived:</p>
<ul>
<li>AP50, AP75, AP[.50:.05:.95] are the most common, with AP[.50:.05:.95] being the primary challenge metric in COCO</li>
<li>AP Across scales: AP<sub>small</sub>, AP<sub>medium</sub>, AP<sub>large</sub>, where small, medium and large have specified areas
<ul>
<li>Scales for COCO are less than 32² for small, between 32² and 96² for medium and more than 96² for large, sizes in pixels</li>
<li>Our data has variable resolution sizes, but on average the resolution is around 0.05m, so small is less than 2.56m², medium is between 2.56m² and 23.04m², and large is more than 23.04m²</li>
</ul></li>
<li><strong>Average Recall</strong> (AR) is also sometimes used similarly, but with restrictions for the number of detections per image
<ul>
<li>It is computed as the area under Recall-IoU -curve for IoU thresholds from [0.5, 1]</li>
</ul></li>
<li>All of these can be applied to bounding boxes and masks</li>
</ul>
<p>All the following functions assume that you have two <code>GeoDataFrame</code>s that have same CRS and matching column <code>label</code>. Usage example is the following:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ground_truth <span class="op">=</span> gpd.read_file(<span class="op">&lt;</span>path_to_ground_truth<span class="op">&gt;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> gpd.read_file(<span class="op">&lt;</span>path_to_results<span class="op">&gt;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># clip the geodataframes to have same extent</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> gpd.clip(results, box(<span class="op">*</span>ground_truth.total_bounds), keep_geom_type<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>ground_truth <span class="op">=</span> gpd.clip(ground_truth, box(<span class="op">*</span>results.total_bounds), keep_geom_type<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create spatial index for faster queries                         </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>res_sindex <span class="op">=</span> results.sindex</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>gt_sindex <span class="op">=</span> ground_truth.sindex</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># TP/FN check with different thresholds, applied to ground truth</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>tp_cols <span class="op">=</span> [<span class="ss">f'TP_</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(i, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.5</span>, <span class="fl">1.04</span>, <span class="fl">0.05</span>)]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>ground_truth[tp_cols] <span class="op">=</span> ground_truth.<span class="bu">apply</span>(<span class="kw">lambda</span> row: is_true_positive(row, results, res_sindex), </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                           axis<span class="op">=</span><span class="dv">1</span>, result_type<span class="op">=</span><span class="st">'expand'</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># TP/FP check with different thresholds, applied to predictions</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>fp_cols <span class="op">=</span> [<span class="ss">f'FP_</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(i, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.5</span>, <span class="fl">1.01</span>, <span class="fl">0.05</span>)]</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>results[fp_cols] <span class="op">=</span> results.<span class="bu">apply</span>(<span class="kw">lambda</span> row: is_false_positive(row, ground_truth, gt_sindex, results, res_sindex), </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                                 axis<span class="op">=</span><span class="dv">1</span>, result_type<span class="op">=</span><span class="st">'expand'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L101" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="poly_iou" class="level3">
<h3 class="anchored" data-anchor-id="poly_iou">poly_IoU</h3>
<blockquote class="blockquote">
<pre><code> poly_IoU (poly_1:shapely.geometry.polygon.Polygon,
           poly_2:shapely.geometry.polygon.Polygon)</code></pre>
</blockquote>
<p>IoU for polygons</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L109" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="poly_dice" class="level3">
<h3 class="anchored" data-anchor-id="poly_dice">poly_dice</h3>
<blockquote class="blockquote">
<pre><code> poly_dice (poly_1:shapely.geometry.polygon.Polygon,
            poly_2:shapely.geometry.polygon.Polygon)</code></pre>
</blockquote>
<p>Dice for polygons</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L116" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_true_positive" class="level3">
<h3 class="anchored" data-anchor-id="is_true_positive">is_true_positive</h3>
<blockquote class="blockquote">
<pre><code> is_true_positive (row, results:geopandas.geodataframe.GeoDataFrame, res_s
                   index:&lt;module'geopandas.sindex'from'/usr/share/minicond
                   a3/envs/test/lib/python3.10/site-
                   packages/geopandas/sindex.py'&gt;)</code></pre>
</blockquote>
<p>Check if a single ground truth mask is TP or FN with 11 different IoU thresholds</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L148" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_false_positive" class="level3">
<h3 class="anchored" data-anchor-id="is_false_positive">is_false_positive</h3>
<blockquote class="blockquote">
<pre><code> is_false_positive (row, ground_truth:geopandas.geodataframe.GeoDataFrame,
                    gt_sindex:&lt;module'geopandas.sindex'from'/usr/share/min
                    iconda3/envs/test/lib/python3.10/site-
                    packages/geopandas/sindex.py'&gt;,
                    results:geopandas.geodataframe.GeoDataFrame, res_sinde
                    x:&lt;module'geopandas.sindex'from'/usr/share/miniconda3/
                    envs/test/lib/python3.10/site-
                    packages/geopandas/sindex.py'&gt;)</code></pre>
</blockquote>
<p>Check if prediction is FP or TP for 11 different IoU thresholds</p>
<p><a href="https://mayrajeo.github.io/drone_detector/metrics.html#average_precision"><code>average_precision</code></a> and <a href="https://mayrajeo.github.io/drone_detector/metrics.html#average_recall"><code>average_recall</code></a> both return <code>dict</code> of the results, with each label and each IoU threshold separately. Each item is 11 item list where each item correspond to a different recall threshold in the range of [0:.1:1] in the case of <a href="https://mayrajeo.github.io/drone_detector/metrics.html#average_precision"><code>average_precision</code></a>, or IoU threshold in the range of [.50:.05:1] in for <a href="https://mayrajeo.github.io/drone_detector/metrics.html#average_recall"><code>average_recall</code></a>.</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L218" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="average_precision" class="level3">
<h3 class="anchored" data-anchor-id="average_precision">average_precision</h3>
<blockquote class="blockquote">
<pre><code> average_precision (ground_truth:geopandas.geodataframe.GeoDataFrame,
                    preds:geopandas.geodataframe.GeoDataFrame)</code></pre>
</blockquote>
<p>Get 11-point AP score for each label separately and with all iou_thresholds</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L259" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="average_recall" class="level3">
<h3 class="anchored" data-anchor-id="average_recall">average_recall</h3>
<blockquote class="blockquote">
<pre><code> average_recall (ground_truth:geopandas.geodataframe.GeoDataFrame,
                 preds:geopandas.geodataframe.GeoDataFrame,
                 max_detections:int=None)</code></pre>
</blockquote>
<p>Get 11-point AR score for each label separately and with all iou_thresholds. If <code>max_detections</code> is not <code>None</code> evaluate with only that most confident predictions Seems to be still bugged, needs fixing</p>
</section>
</section>
<section id="object-detection-metrics-with-pycocotools-and-gis-data" class="level2">
<h2 class="anchored" data-anchor-id="object-detection-metrics-with-pycocotools-and-gis-data">Object detection metrics with pycocotools and gis-data</h2>
<p>Run <a href="https://mayrajeo.github.io/drone_detector/engines.detectron2.predict.html#predict_instance_masks"><code>predict_instance_masks</code></a> or <a href="https://mayrajeo.github.io/drone_detector/engines.detectron2.predict.html#predict_bboxes"><code>predict_bboxes</code></a> for each scene separately, and save the resulting files in <code>data_path</code> containing * folder <code>raster_tiles</code> that contain the corresponding raster data. Required for transforming shapefiles to pixel coordinates * folder <code>vector_tiles</code> that contain ground truth masks * folder <code>predicted_vectors</code> that contain predictions</p>
<p>All files corresponding to the same scene should have the same name, e.g.&nbsp;<code>raster_tiles/1053_Hiidenportti_Chunk9_orto.tif</code> for raster image, <code>vector_tiles/1053_Hiidenportti_Chunk9_orto.geojson</code> for ground truth and <code>predicted_vectors/1053_Hiidenportti_Chunk9_orto.geojson</code> for predictions.</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L294" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="giscocoeval" class="level3">
<h3 class="anchored" data-anchor-id="giscocoeval">GisCOCOeval</h3>
<blockquote class="blockquote">
<pre><code> GisCOCOeval (data_path:str, outpath:str, coco_info:dict,
              coco_licenses:list, coco_categories:list)</code></pre>
</blockquote>
<p>Initialize evaluator with data path and coco information</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L303" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="giscocoeval.prepare_data" class="level3">
<h3 class="anchored" data-anchor-id="giscocoeval.prepare_data">GisCOCOeval.prepare_data</h3>
<blockquote class="blockquote">
<pre><code> GisCOCOeval.prepare_data (gt_label_col:str='label',
                           res_label_col:str='label',
                           rotated_bbox:bool=False, min_bbox_area:int=0)</code></pre>
</blockquote>
<p>Convert GIS-data predictions to COCO-format for evaluation, and save resulting files to self.outpath</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L309" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="giscocoeval.prepare_eval" class="level3">
<h3 class="anchored" data-anchor-id="giscocoeval.prepare_eval">GisCOCOeval.prepare_eval</h3>
<blockquote class="blockquote">
<pre><code> GisCOCOeval.prepare_eval (eval_type:str='segm')</code></pre>
</blockquote>
<p>Prepare COCOeval to evaluate predictions with 100 and 1000 detections. AP metrics are evaluated with 1000 detections and AR with 100</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L318" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="giscocoeval.evaluate" class="level3">
<h3 class="anchored" data-anchor-id="giscocoeval.evaluate">GisCOCOeval.evaluate</h3>
<blockquote class="blockquote">
<pre><code> GisCOCOeval.evaluate (classes_separately:bool=True)</code></pre>
</blockquote>
<p>Run evaluation and print metrics</p>
<hr>
<p><a href="https://github.com/mayrajeo/drone_detector/tree/master/blob/master/drone_detector/metrics.py#L336" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="giscocoeval.save_results" class="level3">
<h3 class="anchored" data-anchor-id="giscocoeval.save_results">GisCOCOeval.save_results</h3>
<blockquote class="blockquote">
<pre><code> GisCOCOeval.save_results (outpath, iou_thresh:float=0.5)</code></pre>
</blockquote>
<p>Saves correctly detected ground truths, correct detections missed ground truths and misclassifications with specified iou_threshold in separate files for each scene</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>