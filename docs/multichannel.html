---

title: Multichannel extensions for fastai image classification tasks


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/11_multichannel.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/11_multichannel.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/mayrajeo/miniconda3/envs/dronedetector/lib/python3.7/site-packages/torch/cuda/__init__.py:52: UserWarning: CUDA initialization: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx (Triggered internally at  /opt/conda/conda-bld/pytorch_1603729047590/work/c10/cuda/CUDAFunctions.cpp:100.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiChannelTensorImage-and-such">MultiChannelTensorImage and such<a class="anchor-link" href="#MultiChannelTensorImage-and-such"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="open_npy" class="doc_header"><code>open_npy</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>open_npy</code>(<strong><code>fn</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="open_geotiff" class="doc_header"><code>open_geotiff</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>open_geotiff</code>(<strong><code>fn</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiChannelTensorImage" class="doc_header"><code>class</code> <code>MultiChannelTensorImage</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L32" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiChannelTensorImage</code>(<strong><code>x</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>TensorImage</code></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_composite" class="doc_header"><code>show_composite</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_composite</code>(<strong><code>img</code></strong>, <strong><code>channels</code></strong>, <strong><code>ax</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(3, 3)</code></em>, <strong><code>title</code></strong>=<em><code>None</code></em>, <strong><code>scale</code></strong>=<em><code>True</code></em>, <strong><code>ctx</code></strong>=<em><code>None</code></em>, <strong><code>vmin</code></strong>=<em><code>None</code></em>, <strong><code>vmax</code></strong>=<em><code>None</code></em>, <strong><code>scale_axis</code></strong>=<em><code>(0, 1)</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Show three channel composite so that channels correspond to R, G and B</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_single_channel" class="doc_header"><code>show_single_channel</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L84" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_single_channel</code>(<strong><code>img</code></strong>, <strong><code>channel</code></strong>, <strong><code>ax</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(3, 3)</code></em>, <strong><code>ctx</code></strong>=<em><code>None</code></em>, <strong><code>title</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_normalized_spectral_index" class="doc_header"><code>show_normalized_spectral_index</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L94" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_normalized_spectral_index</code>(<strong><code>img</code></strong>, <strong><code>channels</code></strong>, <strong><code>ax</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(3, 3)</code></em>, <strong><code>ctx</code></strong>=<em><code>None</code></em>, <strong><code>title</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Show normalized spectral index such as NDVI</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_mean_spectra" class="doc_header"><code>show_mean_spectra</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_mean_spectra</code>(<strong><code>img</code></strong>, <strong><code>ax</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(3, 3)</code></em>, <strong><code>ctx</code></strong>=<em><code>None</code></em>, <strong><code>title</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Show average spectra graph</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="norm" class="doc_header"><code>norm</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>norm</code>(<strong><code>vals</code></strong>, <strong><code>vmin</code></strong>=<em><code>None</code></em>, <strong><code>vmax</code></strong>=<em><code>None</code></em>, <strong><code>axis</code></strong>=<em><code>(0, 1)</code></em>)</p>
</blockquote>
<p>For visualization purposes scale image with `(vals-vmin)/(vmax-vmin),
with vmin and vmax either specified or within 0.01 and 0.99 quantiles of all values</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageBlock" class="doc_header"><code>MultiChannelImageBlock</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L131" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageBlock</code>(<strong><code>chans</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Default behaviour: use all channels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="using_attr" class="doc_header"><code>using_attr</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/basics.py#L582" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>using_attr</code>(<strong><code>f</code></strong>, <strong><code>attr</code></strong>)</p>
</blockquote>
<p>Change function <code>f</code> to operate on <code>attr</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiChannelImageDataLoaders" class="doc_header"><code>class</code> <code>MultiChannelImageDataLoaders</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L144" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiChannelImageDataLoaders</code>(<strong>*<code>loaders</code></strong>, <strong><code>path</code></strong>=<em><code>'.'</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>) :: <code>DataLoaders</code></p>
</blockquote>
<p>Basic wrapper around several <code>DataLoader</code>s.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageDataLoaders.from_folder" class="doc_header"><code>MultiChannelImageDataLoaders.from_folder</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageDataLoaders.from_folder</code>(<strong><code>path</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>, <strong><code>extensions</code></strong>=<em><code>['.tif']</code></em>, <strong><code>train</code></strong>=<em><code>'train'</code></em>, <strong><code>valid</code></strong>=<em><code>'valid'</code></em>, <strong><code>valid_pct</code></strong>=<em><code>None</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>, <strong><code>vocab</code></strong>=<em><code>None</code></em>, <strong><code>item_tfms</code></strong>=<em><code>None</code></em>, <strong><code>batch_tfms</code></strong>=<em><code>None</code></em>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create from imagenet style dataset in <code>path</code> with <code>train</code>, <code>valid</code>, <code>test</code> subfolders (or provide <code>valid_pct</code>).
Optionally list the channels to use.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageDataLoaders.from_path_func" class="doc_header"><code>MultiChannelImageDataLoaders.from_path_func</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L161" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageDataLoaders.from_path_func</code>(<strong><code>path</code></strong>, <strong><code>fnames</code></strong>, <strong><code>label_func</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>, <strong><code>extensions</code></strong>=<em><code>['.tif']</code></em>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>, <strong><code>item_tfms</code></strong>=<em><code>None</code></em>, <strong><code>batch_tfms</code></strong>=<em><code>None</code></em>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create from list of <code>fnames</code> in <code>path</code>s with <code>label_func</code>.
Optionally list the channels to use.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageDataLoaders.from_name_func" class="doc_header"><code>MultiChannelImageDataLoaders.from_name_func</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L175" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageDataLoaders.from_name_func</code>(<strong><code>path</code></strong>, <strong><code>fnames</code></strong>, <strong><code>label_func</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>, <strong><code>extensions</code></strong>=<em><code>['.tif']</code></em>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>, <strong><code>item_tfms</code></strong>=<em><code>None</code></em>, <strong><code>batch_tfms</code></strong>=<em><code>None</code></em>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create from name attrs in list of <code>fnames</code> in <code>path</code>s with <code>label_func</code>.
Optionally list the channels to use.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageDataLoaders.from_shapefile" class="doc_header"><code>MultiChannelImageDataLoaders.from_shapefile</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L214" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageDataLoaders.from_shapefile</code>(<strong><code>path</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>, <strong><code>shp_fname</code></strong>=<em><code>'labels.shp'</code></em>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>, <strong><code>fn_col</code></strong>=<em><code>0</code></em>, <strong><code>folder</code></strong>=<em><code>None</code></em>, <strong><code>suff</code></strong>=<em><code>''</code></em>, <strong><code>label_col</code></strong>=<em><code>1</code></em>, <strong><code>label_delim</code></strong>=<em><code>None</code></em>, <strong><code>y_block</code></strong>=<em><code>None</code></em>, <strong><code>valid_col</code></strong>=<em><code>None</code></em>, <strong><code>item_tfms</code></strong>=<em><code>None</code></em>, <strong><code>batch_tfms</code></strong>=<em><code>None</code></em>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create from shapefile <code>shp_fname</code> in <code>path</code> readable with geopandas.
Optionally list the channels to use.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiChannelImageDataLoaders.from_lists" class="doc_header"><code>MultiChannelImageDataLoaders.from_lists</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L229" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiChannelImageDataLoaders.from_lists</code>(<strong><code>path</code></strong>, <strong><code>fnames</code></strong>, <strong><code>labels</code></strong>, <strong><code>chans</code></strong>=<em><code>None</code></em>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>y_block</code></strong>=<em><code>None</code></em>, <strong><code>item_tfms</code></strong>=<em><code>None</code></em>, <strong><code>batch_tfms</code></strong>=<em><code>None</code></em>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create from list of <code>fnames</code> in <code>path</code>.
Optionally list the channels to use.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Segmentation">Segmentation<a class="anchor-link" href="#Segmentation"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TifSegmentationDataLoaders" class="doc_header"><code>class</code> <code>TifSegmentationDataLoaders</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L252" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TifSegmentationDataLoaders</code>(<strong>*<code>loaders</code></strong>, <strong><code>path</code></strong>=<em><code>'.'</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>) :: <code>DataLoaders</code></p>
</blockquote>
<p>Needs a better name</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RegressionMask" class="doc_header"><code>class</code> <code>RegressionMask</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L285" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RegressionMask</code>(<strong><code>x</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>TensorMask</code></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="RegressionMaskBlock" class="doc_header"><code>RegressionMaskBlock</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/multichannel.py#L305" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>RegressionMaskBlock</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Default behaviour: use all channels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

