---

title: Helpers for detectron2 training


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/41_engines.detectron2.training.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/41_engines.detectron2.training.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Simple-Trainer-for-basic-training">Simple Trainer for basic training<a class="anchor-link" href="#Simple-Trainer-for-basic-training"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Trainer" class="doc_header"><code>class</code> <code>Trainer</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/engines/detectron2/training.py#L24" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Trainer</code>(<strong><code>cfg</code></strong>) :: <code>DefaultTrainer</code></p>
</blockquote>
<p>Trainer class for training detectron2 models, using default augmentations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="transform_rotated_annotations" class="doc_header"><code>transform_rotated_annotations</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/engines/detectron2/training.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>transform_rotated_annotations</code>(<strong><code>annotation</code></strong>, <strong><code>transforms</code></strong>, <strong><code>image_size</code></strong>, <strong><code>keypoint_hflip_indices</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RotatedDatasetMapper" class="doc_header"><code>class</code> <code>RotatedDatasetMapper</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/engines/detectron2/training.py#L54" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RotatedDatasetMapper</code>(<strong><code>is_train</code></strong>:<code>bool</code>, <strong><code>augmentations</code></strong>:<code>List</code>[<code>typing.Union[detectron2.data.transforms.augmentation.Augmentation, fvcore.transforms.transform.Transform]</code>], <strong><code>image_format</code></strong>:<code>str</code>, <strong><code>use_instance_mask</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>use_keypoint</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>instance_mask_format</code></strong>:<code>str</code>=<em><code>'polygon'</code></em>, <strong><code>keypoint_hflip_indices</code></strong>:<code>Optional</code>[<code>ndarray</code>]=<em><code>None</code></em>, <strong><code>precomputed_proposal_topk</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>, <strong><code>recompute_boxes</code></strong>:<code>bool</code>=<em><code>False</code></em>) :: <code>DatasetMapper</code></p>
</blockquote>
<p>A callable which takes a dataset dict in Detectron2 Dataset format,
and map it into a format used by the model.</p>
<p>This is the default callable to be used to map your dataset dict into training data.
You may need to follow it to implement your own one for customized logic,
such as a different way to read or transform images.
See :doc:<code>/tutorials/data_loading</code> for details.</p>
<p>The callable currently does the following:</p>
<ol>
<li>Read the image from "file_name"</li>
<li>Applies cropping/geometric transforms to the image and annotations</li>
<li>Prepare data and annotations to Tensor and :class:<code>Instances</code></li>
</ol>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RotatedTrainer" class="doc_header"><code>class</code> <code>RotatedTrainer</code><a href="https://github.com/jaeeolma/drone_detector/tree/master/drone_detector/engines/detectron2/training.py#L102" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RotatedTrainer</code>(<strong><code>cfg</code></strong>) :: <code>DefaultTrainer</code></p>
</blockquote>
<p>A trainer with default training logic. It does the following:</p>
<ol>
<li>Create a :class:<code>SimpleTrainer</code> using model, optimizer, dataloader
defined by the given config. Create a LR scheduler defined by the config.</li>
<li>Load the last checkpoint or <code>cfg.MODEL.WEIGHTS</code>, if exists, when
<code>resume_or_load</code> is called.</li>
<li>Register a few common hooks defined by the config.</li>
</ol>
<p>It is created to simplify the <strong>standard model training workflow</strong> and reduce code boilerplate
for users who only need the standard training workflow, with standard features.
It means this class makes <em>many assumptions</em> about your training logic that
may easily become invalid in a new research. In fact, any assumptions beyond those made in the
:class:<code>SimpleTrainer</code> are too much for research.</p>
<p>The code of this class has been annotated about restrictive assumptions it makes.
When they do not work for you, you're encouraged to:</p>
<ol>
<li>Overwrite methods of this class, OR:</li>
<li>Use :class:<code>SimpleTrainer</code>, which only does minimal SGD training and
nothing else. You can then add your own hooks if needed. OR:</li>
<li>Write your own training loop similar to <code>tools/plain_train_net.py</code>.</li>
</ol>
<p>See the :doc:<code>/tutorials/training</code> tutorials for more details.</p>
<p>Note that the behavior of this class, like other functions/classes in
this file, is not stable, since it is meant to represent the "common default behavior".
It is only guaranteed to work well with the standard models and training workflow in detectron2.
To obtain more stable behavior, write your own training logic with other public APIs.</p>
<p>Examples:
::
    trainer = DefaultTrainer(cfg)
    trainer.resume_or_load()  # load last checkpoint or MODEL.WEIGHTS
    trainer.train()</p>
<p>Attributes:
    scheduler:
    checkpointer (DetectionCheckpointer):
    cfg (CfgNode):</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>


